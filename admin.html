<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="UTF-8">
<title>Admin THC KING SHOP</title>
<style>
body { font-family: sans-serif; background:#d1f0d8; padding:10px;}
#chat-box, #order-box { border:1px solid #aaa; padding:5px; height:200px; overflow-y:scroll; background:white; margin-bottom:10px;}
</style>
<script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
</head>
<body>

<h2>Admin THC KING SHOP</h2>
<button onclick="login()">ล็อกอิน Admin</button>

<h3>ออเดอร์ลูกค้า</h3>
<div id="order-box"></div>

<h3>แชทลูกค้า</h3>
<div id="chat-box"></div>
<input type="text" id="msg" placeholder="พิมพ์ข้อความตอบ...">
<button onclick="sendMessage()">ส่ง</button>

<script>
const firebaseConfig = {
  apiKey: "API_KEY",
  authDomain: "PROJECT_ID.firebaseapp.com",
  projectId: "PROJECT_ID",
  storageBucket: "PROJECT_ID.appspot.com",
  messagingSenderId: "SENDER_ID",
  appId: "APP_ID"
};
firebase.initializeApp(firebaseConfig);
const db = firebase.firestore();
const auth = firebase.auth();

function login(){
  const email = prompt("อีเมล Admin:");
  const password = prompt("รหัสผ่าน:");
  auth.signInWithEmailAndPassword(email,password)
    .then(()=>alert("ล็อกอิน Admin เรียบร้อย!"))
    .catch(err=>alert(err.message));
}

// ดูออเดอร์เรียลไทม์
db.collection("orders").orderBy("timestamp")
  .onSnapshot(snap=>{
    const box = document.getElementById("order-box");
    box.innerHTML="";
    snap.forEach(doc=>{
      const data = doc.data();
      box.innerHTML+=`<p>${data.user} สั่ง ${data.product} จำนวน ${data.amount} ราคา ${data.price} บาท</p>`;
    });
  });

// แชทตอบลูกค้า
function sendMessage(){
  const text = document.getElementById("msg").value;
  const user = auth.currentUser.email;
  db.collection("messages").add({
    user:user, message:text,
    timestamp:firebase.firestore.FieldValue.serverTimestamp()
  });
  document.getElementById("msg").value="";
}

// ฟังข้อความลูกค้าเรียลไทม์
db.collection("messages").orderBy("timestamp")
  .onSnapshot(snap=>{
    const box = document.getElementById("chat-box");
    box.innerHTML="";
    snap.forEach(doc=>{
      const data = doc.data();
      box.innerHTML+=`<p><b>${data.user}:</b> ${data.message}</p>`;
    });
  });
</script>
</body>
</html>
